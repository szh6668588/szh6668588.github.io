<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æŠ•ç¥¨ç³»ç»Ÿ</title>
    <style>
        /* ====== ä¸åŸæ ·å¼å®Œå…¨ä¸€è‡´ï¼Œä»…è¿½åŠ ç®¡ç†å‘˜åŒºåŸŸ ====== */
        *{margin:0;padding:0;box-sizing:border-box}
        body{font-family:'Microsoft YaHei','PingFang SC',sans-serif;background:linear-gradient(135deg,#667eea 0%,#764ba2 100%);min-height:100vh;padding:20px;display:flex;justify-content:center;align-items:center}
        .container{max-width:1200px;width:100%;background:rgba(255,255,255,.95);border-radius:20px;box-shadow:0 20px 60px rgba(0,0,0,.3);padding:40px}
        h1{text-align:center;color:#667eea;margin-bottom:10px;font-size:2.5em;text-shadow:2px 2px 4px rgba(0,0,0,.1)}
        .subtitle{text-align:center;color:#666;margin-bottom:40px;font-size:1.1em}
        .voting-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(280px,1fr));gap:20px;margin-bottom:40px}
        .candidate-card{background:linear-gradient(135deg,#f5f7fa 0%,#c3cfe2 100%);border-radius:15px;padding:25px;cursor:pointer;transition:all .3s ease;box-shadow:0 5px 15px rgba(0,0,0,.1);position:relative;overflow:hidden}
        .candidate-card::before{content:'';position:absolute;top:0;left:-100%;width:100%;height:100%;background:linear-gradient(90deg,transparent,rgba(255,255,255,.3),transparent);transition:left .5s}
        .candidate-card:hover::before{left:100%}
        .candidate-card:hover{transform:translateY(-5px);box-shadow:0 10px 25px rgba(0,0,0,.2)}
        .candidate-card.voted{background:linear-gradient(135deg,#667eea 0%,#764ba2 100%);color:white}
        .candidate-name{font-size:1.3em;font-weight:bold;margin-bottom:15px;text-align:center}
        .vote-stats{display:flex;justify-content:space-between;align-items:center;margin-top:15px}
        .vote-count{font-size:1.1em;font-weight:bold}
        .vote-percentage{font-size:1.1em;color:#764ba2}
        .candidate-card.voted .vote-percentage{color:#fff}
        .progress-bar{width:100%;height:8px;background:rgba(0,0,0,.1);border-radius:10px;overflow:hidden;margin-top:10px}
        .progress-fill{height:100%;background:linear-gradient(90deg,#667eea,#764ba2);border-radius:10px;transition:width .5s ease;width:0%}
        .candidate-card.voted .progress-fill{background:linear-gradient(90deg,#fff,#f0f0f0)}
        .total-stats{background:linear-gradient(135deg,#667eea 0%,#764ba2 100%);color:white;padding:30px;border-radius:15px;text-align:center;box-shadow:0 10px 30px rgba(0,0,0,.2)}
        .total-stats h2{font-size:2em;margin-bottom:15px}
        .total-votes{font-size:3em;font-weight:bold;text-shadow:2px 2px 4px rgba(0,0,0,.2)}
        .status-message{text-align:center;margin-top:20px;padding:15px;border-radius:10px;font-size:1.1em;display:none}
        .status-message.show{display:block}
        .status-message.success{background:#d4edda;color:#155724;border:2px solid #c3e6cb}
        .status-message.error{background:#f8d7da;color:#721c24;border:2px solid #f5c6cb}
        .checkmark{display:none;position:absolute;top:10px;right:10px;font-size:2em}
        .candidate-card.voted .checkmark{display:block}
        .admin-btn{position:fixed;bottom:30px;right:30px;background:linear-gradient(135deg,#f093fb 0%,#f5576c 100%);color:white;border:none;padding:15px 30px;border-radius:50px;font-size:1em;cursor:pointer;box-shadow:0 5px 20px rgba(245,87,108,.4);transition:all .3s ease;z-index:1000}
        .admin-btn:hover{transform:translateY(-3px);box-shadow:0 8px 25px rgba(245,87,108,.6)}
        .modal{display:none;position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,.7);z-index:2000;justify-content:center;align-items:center}
        .modal.show{display:flex}
        .modal-content{background:white;border-radius:20px;padding:40px;max-width:500px;width:90%;max-height:90vh;overflow-y:auto;box-shadow:0 20px 60px rgba(0,0,0,.5)}
        .modal-header{text-align:center;margin-bottom:30px}
        .modal-header h2{color:#667eea;font-size:2em;margin-bottom:10px}
        .login-form{display:flex;flex-direction:column;gap:20px}
        .form-group{display:flex;flex-direction:column;gap:8px}
        .form-group label{font-weight:bold;color:#333}
        .form-group input{padding:12px;border:2px solid #ddd;border-radius:10px;font-size:1em;transition:border .3s}
        .form-group input:focus{outline:none;border-color:#667eea}
        .btn-group{display:flex;gap:10px;margin-top:20px}
        .btn{flex:1;padding:12px;border:none;border-radius:10px;font-size:1em;cursor:pointer;transition:all .3s}
        .btn-primary{background:linear-gradient(135deg,#667eea 0%,#764ba2 100%);color:white}
        .btn-primary:hover{transform:translateY(-2px);box-shadow:0 5px 15px rgba(102,126,234,.4)}
        .btn-secondary{background:#f0f0f0;color:#333}
        .btn-secondary:hover{background:#e0e0e0}
        .admin-panel{display:none}
        .admin-panel.show{display:block}
        .admin-item{background:#f8f9fa;padding:20px;border-radius:10px;margin-bottom:15px;display:flex;justify-content:space-between;align-items:center}
        .admin-item-name{font-weight:bold;font-size:1.1em;color:#333}
        .admin-item-controls{display:flex;gap:10px;align-items:center}
        .vote-input{width:80px;padding:8px;border:2px solid #ddd;border-radius:8px;text-align:center;font-size:1em}
        .btn-small{padding:8px 15px;border:none;border-radius:8px;cursor:pointer;font-size:.9em;transition:all .3s}
        .btn-update{background:#28a745;color:white}
        .btn-update:hover{background:#218838}
        .logout-btn{width:100%;margin-top:20px;background:#dc3545;color:white}
        .logout-btn:hover{background:#c82333}
        @media(max-width:768px){.container{padding:20px}h1{font-size:1.8em}.voting-grid{grid-template-columns:1fr}.admin-btn{bottom:20px;right:20px;padding:12px 20px}.modal-content{padding:25px}}
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸŒŸ åœ¨çº¿æŠ•ç¥¨ç³»ç»Ÿ ğŸŒŸ</h1>
        <p class="subtitle">è¯·é€‰æ‹©æ‚¨æ”¯æŒçš„å€™é€‰äººï¼ˆæ¯äººä»…å¯æŠ•ç¥¨ä¸€æ¬¡ï¼‰</p>
        <div class="voting-grid" id="votingGrid"></div>
        <div class="status-message" id="statusMessage"></div>
        <div class="total-stats">
            <h2>æ€»æŠ•ç¥¨æ•°</h2>
            <div class="total-votes" id="totalVotes">0</div>
        </div>
    </div>

    <button class="admin-btn" onclick="openAdminModal()">ğŸ” ç®¡ç†å‘˜ç™»å½•</button>

    <div class="modal" id="adminModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>ğŸ” ç®¡ç†å‘˜ç™»å½•</h2>
                <p style="color:#666">è´¦å·å’Œå¯†ç å‡ä¸ºï¼š1</p>
            </div>
            <div id="loginForm" class="login-form">
                <div class="form-group"><label>è´¦å·</label><input type="text" id="username" placeholder="è¯·è¾“å…¥è´¦å·"></div>
                <div class="form-group"><label>å¯†ç </label><input type="password" id="password" placeholder="è¯·è¾“å…¥å¯†ç "></div>
                <div class="btn-group">
                    <button class="btn btn-primary" onclick="login()">ç™»å½•</button>
                    <button class="btn btn-secondary" onclick="closeAdminModal()">å–æ¶ˆ</button>
                </div>
            </div>
            <div id="adminPanel" class="admin-panel">
                <div class="modal-header"><h2>ğŸ“Š æŠ•ç¥¨ç®¡ç†é¢æ¿</h2></div>
                <div id="adminContent"></div>

                <!-- æ–°å¢ä¸¤å¤§åŠŸèƒ½æŒ‰é’® -->
                <div style="margin-top:25px;text-align:center;display:flex;gap:15px;justify-content:center;flex-wrap:wrap">
                    <button class="btn btn-secondary" onclick="resetVotes()">ğŸ”„ é‡ç½®æŠ•ç¥¨</button>
                    <button class="btn btn-primary" onclick="toggleCandidateMgr()">ğŸ‘¥ æ·»åŠ /åˆ é™¤äººå‘˜</button>
                </div>

                <!-- äººå‘˜ç®¡ç†æŠ˜å åŒº -->
                <div id="candidateMgr" style="display:none;margin-top:20px;background:#fff;border:2px dashed #667eea;border-radius:12px;padding:20px">
                    <h3 style="margin-bottom:15px;color:#667eea">äººå‘˜ç®¡ç†</h3>
                    <div class="form-group">
                        <label>æ·»åŠ æ–°å€™é€‰äºº</label>
                        <div style="display:flex;gap:10px"><input id="newName" type="text" placeholder="è¾“å…¥å§“å"><button class="btn-small btn-update" onclick="addCandidate()">æ·»åŠ </button></div>
                    </div>
                    <div class="form-group" style="margin-top:15px">
                        <label>åˆ é™¤å€™é€‰äºº</label>
                        <select id="delSelect" style="padding:8px;border-radius:8px;border:2px solid #ddd;width:100%"></select>
                        <button class="btn-small btn-secondary" style="margin-top:8px;width:100%" onclick="delCandidate()">åˆ é™¤é€‰ä¸­</button>
                    </div>
                </div>

                <button class="btn logout-btn" onclick="logout()">é€€å‡ºç™»å½•</button>
            </div>
        </div>
    </div>

    <script>
        /* ========= åŸºç¡€æ•°æ®ä¸åˆå§‹åŒ– ========= */
        let candidates = [
            'ç‹æµ©ç„¶','æå­è½©','å¼ å®‡æ™¨','é™ˆå˜‰è±ª','åˆ˜é€¸æ™¨',
            'å‘¨å­ç¿','å´æµ©å®‡','é©¬åšæ–‡','æœ±ä¿Šç†™','èƒ¡å­å¢¨',
            'æ¨é›¨æ¡','é»„æ¬£æ€¡','èµµæ¢“æ¶µ','å¾è‰ºè¯º','å­™è‹¥æºª',
            'æ—è¯—çª','éƒ­é›¨æ¬£','ä½•ä½³æ€¡','é«˜é›¨æ¡','ç½—æ€çª'
        ];
        let votes = {};
        let hasVoted = false;
        let isAdmin = false;
        const ADMIN_USERNAME = '1';
        const ADMIN_PASSWORD = '1';

        function init() {
            const savedCandidates = localStorage.getItem('candidates');
            if (savedCandidates) candidates = JSON.parse(savedCandidates);
            candidates.forEach(n => votes[n] = 0);
            loadVotes();
            renderCandidates();
        }
        function loadVotes() {
            const s = localStorage.getItem('votes');
            const v = localStorage.getItem('hasVoted');
            if (s) votes = JSON.parse(s);
            if (v === 'true') hasVoted = true;
        }
        function saveVotes() {
            localStorage.setItem('votes', JSON.stringify(votes));
            localStorage.setItem('hasVoted', hasVoted);
        }
        function renderCandidates() {
            const grid = document.getElementById('votingGrid');
            const total = Object.values(votes).reduce((a, b) => a + b, 0);
            grid.innerHTML = '';
            candidates.forEach(name => {
                const card = document.createElement('div');
                card.className = 'candidate-card';
                const count = votes[name];
                const percent = total > 0 ? ((count / total) * 100).toFixed(1) : 0;
                if (hasVoted && localStorage.getItem('votedFor') === name) card.classList.add('voted');
                card.innerHTML = `
                    <div class="checkmark">âœ“</div>
                    <div class="candidate-name">${name}</div>
                    <div class="progress-bar"><div class="progress-fill" style="width:${percent}%"></div></div>
                    <div class="vote-stats"><span class="vote-count">${count} ç¥¨</span><span class="vote-percentage">${percent}%</span></div>
                `;
                if (!hasVoted) card.addEventListener('click', () => vote(name));
                grid.appendChild(card);
            });
            document.getElementById('totalVotes').textContent = total;
        }
        function vote(name) {
            if (hasVoted) return showMessage('æ‚¨å·²ç»æŠ•è¿‡ç¥¨äº†ï¼', 'error');
            votes[name]++; hasVoted = true; localStorage.setItem('votedFor', name); saveVotes();
            showMessage(`æŠ•ç¥¨æˆåŠŸï¼æ‚¨æŠ•ç»™äº† ${name}`, 'success'); renderCandidates();
        }
        function showMessage(text, type) {
            const m = document.getElementById('statusMessage');
            m.textContent = text; m.className = `status-message show ${type}`;
            setTimeout(() => m.classList.remove('show'), 3000);
        }

        /* ========= ç®¡ç†å‘˜ç›¸å…³ ========= */
        function openAdminModal() { document.getElementById('adminModal').classList.add('show'); }
        function closeAdminModal() {
            document.getElementById('adminModal').classList.remove('show');
            document.getElementById('loginForm').style.display = 'block';
            document.getElementById('adminPanel').classList.remove('show');
            document.getElementById('username').value = '';
            document.getElementById('password').value = '';
        }
        function login() {
            const u = document.getElementById('username').value;
            const p = document.getElementById('password').value;
            if (u === ADMIN_USERNAME && p === ADMIN_PASSWORD) {
                isAdmin = true; document.getElementById('loginForm').style.display = 'none';
                document.getElementById('adminPanel').classList.add('show'); renderAdminPanel();
                showMessage('ç™»å½•æˆåŠŸï¼', 'success');
            } else showMessage('è´¦å·æˆ–å¯†ç é”™è¯¯ï¼', 'error');
        }
        function logout() { isAdmin = false; closeAdminModal(); showMessage('å·²é€€å‡ºç™»å½•', 'success'); }
        function renderAdminPanel() {
            const c = document.getElementById('adminContent'); c.innerHTML = '';
            candidates.forEach(name => {
                const d = document.createElement('div'); d.className = 'admin-item';
                d.innerHTML = `
                    <div class="admin-item-name">${name}</div>
                    <div class="admin-item-controls">
                        <input type="number" class="vote-input" value="${votes[name]}" min="0" id="input-${name}">
                        <button class="btn-small btn-update" onclick="updateVote('${name}')">æ›´æ–°</button>
                    </div>
                `;
                c.appendChild(d);
            });
        }
        function updateVote(name) {
            const v = parseInt(document.getElementById(`input-${name}`).value) || 0;
            if (v < 0) return showMessage('ç¥¨æ•°ä¸èƒ½ä¸ºè´Ÿæ•°ï¼', 'error');
            votes[name] = v; saveVotes(); renderCandidates(); renderAdminPanel(); showMessage(`å·²æ›´æ–° ${name} çš„ç¥¨æ•°ä¸º ${v}`, 'success');
        }

        /* ========= æ–°å¢ä¸‰å¤§åŠŸèƒ½ ========= */
        function resetVotes() {
            if (!confirm('ç¡®å®šè¦æ¸…ç©ºæ‰€æœ‰æŠ•ç¥¨æ•°æ®ï¼Ÿæ­¤æ“ä½œä¸å¯æ¢å¤ï¼')) return;
            candidates.forEach(n => votes[n] = 0);
            hasVoted = false;
            localStorage.removeItem('votes');
            localStorage.removeItem('hasVoted');
            localStorage.removeItem('votedFor');
            renderCandidates(); renderAdminPanel(); toggleCandidateMgr(false);
            showMessage('å·²é‡ç½®æ‰€æœ‰æŠ•ç¥¨ï¼', 'success');
        }
        function toggleCandidateMgr(show) {
            const box = document.getElementById('candidateMgr');
            box.style.display = (show === false || box.style.display === 'block') ? 'none' : 'block';
            if (box.style.display === 'block') populateDelSelect();
        }
        function populateDelSelect() {
            const sel = document.getElementById('delSelect');
            sel.innerHTML = '<option value="">è¯·é€‰æ‹©è¦åˆ é™¤çš„äººå‘˜</option>';
            candidates.forEach(n => sel.innerHTML += `<option value="${n}">${n}</option>`);
        }
        function addCandidate() {
            const name = document.getElementById('newName').value.trim();
            if (!name) return showMessage('å§“åä¸èƒ½ä¸ºç©ºï¼', 'error');
            if (candidates.includes(name)) return showMessage('è¯¥äººå·²å­˜åœ¨ï¼', 'error');
            candidates.push(name); votes[name] = 0;
            localStorage.setItem('candidates', JSON.stringify(candidates));
            renderCandidates(); renderAdminPanel(); toggleCandidateMgr(false);
            showMessage(`å·²æ·»åŠ  ${name}`, 'success');
        }
        function delCandidate() {
            const name = document.getElementById('delSelect').value;
            if (!name) return;
            if (candidates.length <= 1) return showMessage('è‡³å°‘ä¿ç•™ä¸€åå€™é€‰äººï¼', 'error');
            if (!confirm(`ç¡®å®šåˆ é™¤ ${name}ï¼Ÿ`)) return;
            const idx = candidates.indexOf(name);
            candidates.splice(idx, 1);
            delete votes[name];
            localStorage.setItem('candidates', JSON.stringify(candidates));
            renderCandidates(); renderAdminPanel(); toggleCandidateMgr(false);
            showMessage(`å·²åˆ é™¤ ${name}`, 'success');
        }

        init();
    </script>
</body>
</html>
